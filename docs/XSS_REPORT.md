# Отчет по защите от XSS

Дата: 21.09.2025

Приложение было проанализировано на защиту от xss атак. В ходе анализа уязвимостей выялено не было.
В приложении используется свой локальный бэкенд на node js, сервер ssr, бэкенд практикума, а также фронтенд на react.

## 1. Общие подходы к защите

В приложении используется несколько уровней защиты от XSS:

1. **Серверная очистка данных**
    - Все запросы к локальному бэкенду проходят через мидлвару `xssMiddleware`, которая рекурсивно очищает `req.body`, `req.query` и `req.params` с помощью библиотеки [xss](https://www.npmjs.com/package/xss).
    - Фрагмент кода:
      ```ts
      sanitizeObjectInPlace(req.body as Record<string, unknown> | undefined);
      sanitizeObjectInPlace(req.query as unknown as Record<string, unknown> | undefined);
      sanitizeObjectInPlace(req.params as unknown as Record<string, unknown> | undefined);
      ```
    - Это защищает базу данных от сохранения небезопасного HTML/JS-кода, если пользователи вводят текст, который потом будут видеть другие пользователи (топики, комментарии)

2. **Схемная валидация входных данных**
    - Используется [Joi/Celebrate](https://github.com/arb/celebrate) для проверки всех входных данных.
    - Пример:
      ```ts
      import { celebrate, Joi } from 'celebrate';

      export const createTopicValidation = celebrate({
        body: Joi.object().keys({
          name: Joi.string().min(1).required(),
        }),
      });
      ```
    - Это предотвращает ввод некорректных данных и уменьшает риск XSS через серверные поля.

3. **SSR и передача state в HTML**
    - Используется [serialize-javascript](https://www.npmjs.com/package/serialize-javascript) для безопасной сериализации `initialState` в HTML при SSR:
      ```ts
      <script>window.__APP_INITIAL_STATE__ = ${serialize(initialState, { isJSON: true })}</script>
      ```
    - `serialize-javascript` экранирует `<`, `>`, `&`, а также предотвращает внедрение скриптов через закрывающий тег `</script>`.

4. **Фронтенд**
    - React **автоматически экранирует** спецсимволы при рендере через JSX.
    - Данные, которые отображаются пользователю через JSX (`{value}`), безопасны от XSS, если не используется `dangerouslySetInnerHTML`
    - Поля в формах содержат валидацию специфичную для каждого поля

---

## 2. Разделение данных по источнику и видимости

| Страница   | Данные                                              | Видны другим пользователям? | Источник                      | Защита                                                                                                                                                                                  |
|------------|-----------------------------------------------------|-----------------------------|-------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Лидербоард | **Логины пользователей, счет**                      | Да                          | Бэкенд практикума             | React JSX экранирует                                                                                                                                                                    |
| Форум      | **Комментарии, топики**                             | Да                          | Локальный бэкенд              | React JSX экранирует. На бэкенде идет проверка входных данных по схеме, а также очистка в мидлваре                                                                                      |
| Профиль    | **Аватар**                                          | Нет                         | Бэкенд практикума             | Идет проверка наличия url. А также с вставка идет через jsx, и с бэкенда приходит только часть url, поэтому xss атака практически невозможна. Оставщаяся часть url берется из константы |
| Хедер      | **Имя текущего пользователя**                       | Нет                         | Бэкенд практикума                | React JSX экранирует                                                                                                                                                                    |

